<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="__key_resource_suggestion_service_8cs_source" xml:lang="en-US">
<title>KeyResourceSuggestionService.cs</title>
<indexterm><primary>Application/Services/KeyResourceSuggestionService.cs</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00001"/>00001 <emphasis role="keyword">using&#32;</emphasis>System.Collections.Generic;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00002"/>00002 <emphasis role="keyword">using&#32;</emphasis>System.Linq;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00003"/>00003 <emphasis role="keyword">using&#32;</emphasis>System.Threading.Tasks;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00004"/>00004 <emphasis role="keyword">using&#32;</emphasis><link linkend="_namespace_plan_athena_1_1_core_1_1_application_1_1_interfaces">PlanAthena.Core.Application.Interfaces</link>;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00005"/>00005 <emphasis role="keyword">using&#32;</emphasis><link linkend="_namespace_plan_athena_1_1_core_1_1_domain">PlanAthena.Core.Domain</link>;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00006"/>00006 <emphasis role="keyword">using&#32;</emphasis><link linkend="_namespace_plan_athena_1_1_core_1_1_domain_1_1_value_objects">PlanAthena.Core.Domain.ValueObjects</link>;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00007"/>00007 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00008"/>00008 <emphasis role="keyword">namespace&#32;</emphasis><link linkend="_namespace_plan_athena_1_1_core_1_1_application_1_1_services">PlanAthena.Core.Application.Services</link>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00009"/>00009 {
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00010"/><link linkend="_class_plan_athena_1_1_core_1_1_application_1_1_services_1_1_key_resource_suggestion_service">00010</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;<emphasis role="keyword">class&#32;</emphasis><link linkend="_class_plan_athena_1_1_core_1_1_application_1_1_services_1_1_key_resource_suggestion_service">KeyResourceSuggestionService</link>&#32;:&#32;<link linkend="_interface_plan_athena_1_1_core_1_1_application_1_1_interfaces_1_1_i_key_resource_suggestion_service">IKeyResourceSuggestionService</link>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00011"/>00011 &#32;&#32;&#32;&#32;{
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00012"/>00012 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">private</emphasis>&#32;<emphasis role="keyword">const</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;MAX_SUGGESTIONS&#32;=&#32;3;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00013"/>00013 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00020"/><link linkend="_class_plan_athena_1_1_core_1_1_application_1_1_services_1_1_key_resource_suggestion_service_1a517c003ea49a39e59472b241887f4d5e">00020</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keyword">public</emphasis>&#32;Task&lt;List&lt;OuvrierId&gt;&gt;&#32;<link linkend="_class_plan_athena_1_1_core_1_1_application_1_1_services_1_1_key_resource_suggestion_service_1a517c003ea49a39e59472b241887f4d5e">SuggererOuvriersClesAsync</link>(<link linkend="_class_plan_athena_1_1_core_1_1_domain_1_1_chantier">Chantier</link>&#32;chantier)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00021"/>00021 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00022"/>00022 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(chantier.<link linkend="_class_plan_athena_1_1_core_1_1_domain_1_1_chantier_1accadb484958f731489ce83dfcd982ba0">Ouvriers</link>.Count&#32;==&#32;0&#32;||&#32;!chantier.<link linkend="_class_plan_athena_1_1_core_1_1_domain_1_1_chantier_1a6e269d9bdd8c78a832b5bb14d855585c">ObtenirToutesLesTaches</link>().Any())
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00023"/>00023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00024"/>00024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;Task.FromResult(<emphasis role="keyword">new</emphasis>&#32;List&lt;OuvrierId&gt;());
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00025"/>00025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00026"/>00026 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00027"/>00027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;1.&#32;Calculer&#32;la&#32;charge&#32;totale&#32;en&#32;heures-homme&#32;pour&#32;chaque&#32;métier.</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00028"/>00028 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;chargeParMetier&#32;=&#32;chantier.<link linkend="_class_plan_athena_1_1_core_1_1_domain_1_1_chantier_1a6e269d9bdd8c78a832b5bb14d855585c">ObtenirToutesLesTaches</link>()
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00029"/>00029 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.GroupBy(t&#32;=&gt;&#32;t.MetierRequisId)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00030"/>00030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.ToDictionary(g&#32;=&gt;&#32;g.Key,&#32;g&#32;=&gt;&#32;g.Sum(t&#32;=&gt;&#32;t.HeuresHommeEstimees.Value));
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00031"/>00031 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00032"/>00032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;2.&#32;Calculer&#32;la&#32;rareté&#32;de&#32;chaque&#32;métier&#32;(combien&#32;d&apos;ouvriers&#32;le&#32;possèdent).</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00033"/>00033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;rareteParMetier&#32;=&#32;chantier.Ouvriers.Values
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00034"/>00034 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.SelectMany(o&#32;=&gt;&#32;o.Competences.Keys)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00035"/>00035 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.GroupBy(metierId&#32;=&gt;&#32;metierId)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00036"/>00036 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.ToDictionary(g&#32;=&gt;&#32;g.Key,&#32;g&#32;=&gt;&#32;g.Count());
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00037"/>00037 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00038"/>00038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;3.&#32;Calculer&#32;un&#32;score&#32;de&#32;criticité&#32;pour&#32;chaque&#32;ouvrier.</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00039"/>00039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;scoresOuvriers&#32;=&#32;<emphasis role="keyword">new</emphasis>&#32;Dictionary&lt;OuvrierId,&#32;double&gt;();
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00040"/>00040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;ouvrier&#32;<emphasis role="keywordflow">in</emphasis>&#32;chantier.Ouvriers.Values)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00041"/>00041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00042"/>00042 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">double</emphasis>&#32;scoreTotal&#32;=&#32;0;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00043"/>00043 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">foreach</emphasis>&#32;(var&#32;competenceId&#32;<emphasis role="keywordflow">in</emphasis>&#32;ouvrier.Competences.Keys)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00044"/>00044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00045"/>00045 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;chargeParMetier.TryGetValue(competenceId,&#32;out&#32;<emphasis role="keywordtype">int</emphasis>&#32;charge);
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00046"/>00046 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;rareteParMetier.TryGetValue(competenceId,&#32;out&#32;<emphasis role="keywordtype">int</emphasis>&#32;rarete);
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00047"/>00047 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00048"/>00048 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;(charge&#32;&gt;&#32;0&#32;&amp;&amp;&#32;rarete&#32;&gt;&#32;0)
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00049"/>00049 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00050"/>00050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Le&#32;score&#32;pour&#32;cette&#32;compétence&#32;est&#32;la&#32;charge&#32;de&#32;travail&#32;divisée&#32;par&#32;le&#32;nombre&#32;de&#32;personnes&#32;pouvant&#32;la&#32;faire.</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00051"/>00051 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;Une&#32;charge&#32;élevée&#32;et&#32;une&#32;rareté&#32;faible&#32;(ex:&#32;1&#32;seule&#32;personne)&#32;donnent&#32;un&#32;score&#32;élevé.</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00052"/>00052 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordtype">double</emphasis>&#32;scoreCompetence&#32;=&#32;(double)charge&#32;/&#32;rarete;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00053"/>00053 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scoreTotal&#32;+=&#32;scoreCompetence;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00054"/>00054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00055"/>00055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00056"/>00056 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;scoresOuvriers[ouvrier.Id]&#32;=&#32;scoreTotal;
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00057"/>00057 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00058"/>00058 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00059"/>00059 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">//&#32;4.&#32;Trier&#32;les&#32;ouvriers&#32;par&#32;score&#32;et&#32;retourner&#32;les&#32;meilleurs&#32;suggestions.</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00060"/>00060 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;ouvriersDejaCles&#32;=&#32;chantier.ConfigCdC?.OuvriersClefs&#32;??&#32;<emphasis role="keyword">new</emphasis>&#32;HashSet&lt;OuvrierId&gt;();
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00061"/>00061 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00062"/>00062 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;var&#32;suggestions&#32;=&#32;scoresOuvriers
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00063"/>00063 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.Where(kvp&#32;=&gt;&#32;!ouvriersDejaCles.Contains(kvp.Key))&#32;<emphasis role="comment">//&#32;Exclure&#32;ceux&#32;déjà&#32;marqués&#32;comme&#32;clés</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00064"/>00064 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.OrderByDescending(kvp&#32;=&gt;&#32;kvp.Value)&#32;<emphasis role="comment">//&#32;Trier&#32;par&#32;score&#32;décroissant</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00065"/>00065 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.Select(kvp&#32;=&gt;&#32;kvp.Key)&#32;<emphasis role="comment">//&#32;Sélectionner&#32;l&apos;ID&#32;de&#32;l&apos;ouvrier</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00066"/>00066 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.Take(MAX_SUGGESTIONS)&#32;<emphasis role="comment">//&#32;Prendre&#32;les&#32;N&#32;meilleurs</emphasis>
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00067"/>00067 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;.ToList();
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00068"/>00068 
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00069"/>00069 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;Task.FromResult(suggestions);
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00070"/>00070 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00071"/>00071 &#32;&#32;&#32;&#32;}
<anchor xml:id="__key_resource_suggestion_service_8cs_source_1l00072"/>00072 }
</programlisting></section>
