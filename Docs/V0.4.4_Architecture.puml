@startuml
'---------------------------------
' Configuration
'---------------------------------
!theme toy
skinparam linetype ortho
skinparam packageStyle rectangle
skinparam backgroundColor White
skinparam componentStyle uml2
skinparam shadowing false

' Couleurs par couche
skinparam package {
  BackgroundColor<<UI>> LightBlue
  BorderColor<<UI>> DarkBlue
  BackgroundColor<<Business>> LightGreen
  BorderColor<<Business>> DarkGreen
  BackgroundColor<<Data>> LightYellow
  BorderColor<<Data>> DarkOrange
  BackgroundColor<<External>> LightGray
  BorderColor<<External>> Black
}

title Diagramme d'Architecture de l'Application\n<size:12><i>Architecture en couches avec flux de d√©pendances</i></size>

'---------------------------------
' D√©finition des Couches et Composants (avec descriptions int√©gr√©es)
'---------------------------------
package "üñ•Ô∏è **Interface Utilisateur**" <<UI>> as UI {
  component [MainForm] as MF
  component [TacheForm] as TF
  component [OuvrierForm] as OF
  component [MetierForm] as MetF
}

package "‚öôÔ∏è **Services M√©tier**" <<Business>> as Business {
  component "<b>ProjetService</b>\n<size:10><i>G√®re la structure (Lots, Blocs, T√¢ches)</i>" as PS
  component "<b>RessourceService</b>\n<size:10><i>G√®re les ressources (M√©tiers, Ouvriers)</i>" as RS
  component "<b>PlanificationService</b>\n<size:10><i>Orchestre la planification</i>" as PlanS
  
  package "Logique de Traitement" as Processing {
    component [DataTransformer] as DT
    component [PreparationSolveur] as PrepS
    component [ConsolidationResultat] as CR
    component "<b>DependanceBuilder</b>\n<size:10><i>Logique des r√®gles de pr√©c√©dence</i>" as DB
  }
}

package "üîß **Infrastructure & Acc√®s Donn√©es**" <<Data>> as DataLayer {
  component "<b>ProjetRepository</b>\n<size:10><i>Persistance du projet (JSON)</i>" as PR
  component "<b>ImportService</b>\n<size:10><i>Orchestre l'import (CSV)</i>" as IS
  component [ExportServices] as ES
  component [IdGenerator] as IG
  component [CsvDataService] as CSV
}

package "üåç **Moteur Externe**" <<External>> as External {
  component "<b>PlanAthenaCore</b>\n<size:10><i>Moteur de calcul (DLL externe)</i>" as PAC
}

'---------------------------------
' Relations & Structure
'---------------------------------
UI -[hidden]d-> Business
Business -[hidden]d-> DataLayer

' Flux principal entre couches
UI ..> Business : "Appels m√©tier"
Business ..> DataLayer : "Acc√®s donn√©es"
Business --> External : "Calcul externe"

' Relations IHM
MF ..> PS
MF ..> RS
MF ..> PlanS
MF ..> PR
MF ..> IS
TF ..> PS
TF ..> RS
TF ..> DB
OF ..> RS
OF ..> IS
MetF ..> RS
MetF ..> DB

' Relations Couche M√©tier
PlanS ..> DT
PlanS ..> PrepS
PlanS ..> CR
PlanS ..> PAC
DB ..> PS
DB ..> RS

' Relations Couche Donn√©es / Infra
IS --> PS
IS --> RS
IS ..> IG
IS ..> CSV

'---------------------------------
' L√©gende
'---------------------------------
legend right
  <b>L√©gende</b>
  ..> Utilisation / Appel
  --> D√©pendance forte
  
  <b>Flux Principal</b>
  IHM ‚Üí M√©tier ‚Üí Donn√©es
  M√©tier ‚Üí Moteur Externe
end legend

@enduml