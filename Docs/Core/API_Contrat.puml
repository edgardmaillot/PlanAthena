@startuml
' --- Configuration ---
skinparam componentStyle uml2
skinparam linetype ortho
skinparam ranksep 60
skinparam nodesep 60
skinparam shadowing false
title Contrat de Service API - PlanAthena.Core (Architecture Cible)
package "Point d'Entrée" {
class "PlanAthenaCoreFacade" as Facade {
+ ProcessChantierAsync(input): Task<ProcessChantierResultDto>
}
}
package "Contrat d'Entrée (Input DTOs)" <<Rectangle>> {
class ChantierSetupInputDto {
' ... propriétés ...
}
class "OptimizationConfigDto" as OptiConfig
class CalendrierTravailDefinitionDto
class TacheDto
class OuvrierDto
' ... autres DTOs ...
}
package "Contrat de Sortie (Output DTOs)" <<Cloud>> {
class ProcessChantierResultDto {
+ ChantierId: string
+ Etat: EtatTraitementInput
+ Messages: IReadOnlyList<MessageValidationDto>
+ OptimisationResultat: PlanningOptimizationResultDto
}

class "<b>PlanningOptimizationResultDto</b>" as POResult <<(M,Lime) Modified>> {
    + Status: OptimizationStatus
    + Affectations: IReadOnlyList<AffectationDto>
    ' ... autres propriétés ...
    --
    + <b>FeuillesDeTemps: IReadOnlyList<FeuilleDeTempsOuvrierDto> <<(N,SkyBlue) New>></b>
}

' --- NOUVEAU DTO ---
class FeuilleDeTempsOuvrierDto <<(N,SkyBlue) New>> {
  + OuvrierId: string
  + OuvrierNom: string
  + PlanningJournalier: IReadOnlyDictionary<DateTime, long>
}

note top of POResult
    <b>Modifications Clés :</b>
    - Ajout de <b>FeuillesDeTemps</b> pour le planning détaillé.
    - L'analyse métier est désormais externe à la DLL.
end note

class MessageValidationDto
class AffectationDto


}
' --- Relations de Contrat ---
Facade .u.> ChantierSetupInputDto : "<<accepte>>"
Facade .d.> ProcessChantierResultDto : "<<retourne>>"
ChantierSetupInputDto "1" *-r- "0..1" OptiConfig
ChantierSetupInputDto "1" *-l- "1" CalendrierTravailDefinitionDto
ChantierSetupInputDto "1" -u- "1.." TacheDto
ChantierSetupInputDto "1" -u- "1.." OuvrierDto
ProcessChantierResultDto "1" *-r- "0..1" POResult
POResult "1" --> "0.." FeuilleDeTempsOuvrierDto : "contient"
POResult "1" --> "0.." AffectationDto : "contient"
ProcessChantierResultDto ..> PlanningAnalysisReportDto : <<supprimé>>
@enduml