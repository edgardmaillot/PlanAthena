@startuml
' --- Configuration FORCÃ‰E pour layout vertical ---
!define DIRECTION top to bottom direction

top to bottom direction
skinparam minClassWidth 180
skinparam maxMessageSize 200
skinparam packageStyle rectangle
skinparam linetype ortho
skinparam ranksep 80
skinparam nodesep 60

skinparam package {
  borderColor #555555
  borderThickness 2
  fontColor #333333
  backgroundColor #F8F9FA
}
skinparam class {
  borderColor #007ACC
  backgroundColor #DDEEFF
  arrowColor #005588
  shadowing false
}
title Architecture GÃ©nÃ©rale de PlanAthena (SimplifiÃ©e en Couches)

' ================================================
' === COUCHE 1 : PRÃ‰SENTATION (UI)             ===
' ================================================
package "ðŸ–¥ï¸ Couche 1: PrÃ©sentation (UI)" as PresentationLayer {
  class "Interface Utilisateur (WinForms)" as UI_Forms
  note top of UI_Forms
    Toutes les Forms et Controls (TacheForm, MainForm, PertDiagramControl...)
    GÃ¨re l'affichage et les interactions utilisateur
  end note
}

' ================================================
' === COUCHE 2 : APPLICATION (Orchestration)   ===
' ================================================
package "ðŸŽ¯ Couche 2: Application (Orchestration)" as ApplicationLayer {
  class "Gestion Projet & Planification" as App_Orchestration
  note top of App_Orchestration
    (ProjetService, PlanificationService, ImportOrchestrationService)
    Coordonne les workflows de haut niveau
  end note
}

' ================================================
' === COUCHE 3 : SERVICES DU DOMAINE           ===
' ================================================
package "âš™ï¸ Couche 3: Services du Domaine" as DomainServicesLayer {
  class "Gestion DonnÃ©es MaÃ®tresses" as Domain_DataManagement
  note top of Domain_DataManagement
    (TacheService, OuvrierService, MetierService, LotService, BlocService)
    Logique mÃ©tier fondamentale et CRUD sur les entitÃ©s
  end note
}

' ================================================
' === COUCHE 4 : UTILITAIRES D'APPLICATION     ===
' ================================================
package "ðŸ”§ Couche 4: Utilitaires d'Application" as AppUtilitiesLayer {
  class "PrÃ©paration & Traitement DonnÃ©es" as App_DataProcessing
  note top of App_DataProcessing
    (DataTransformer, PreparationSolveurService, ResultatConsolidationService, DependanceBuilder, ConfigurationBuilder)
    Services de support pour la transformation et le calcul de donnÃ©es
  end note
}

' ================================================
' === COUCHE 5 : INFRASTRUCTURE                ===
' ================================================
package "ðŸ—ï¸ Couche 5: Infrastructure" as InfrastructureLayer {
  class "AccÃ¨s Fichiers & Export" as Infra_DataAccess
  note top of Infra_DataAccess
    (CsvDataService, ExcelReader, GanttExportService, IdGeneratorService, ImportService)
    Gestion des fichiers, I/O et intÃ©grations externes
  end note
}

' ================================================
' === DÃ‰PENDANCE EXTERNE : PlanAthena.Core     ===
' ================================================
package "ðŸŒ DÃ©pendance Externe" as ExternalLayer {
  class "PlanAthena.Core (Solveur Externe)" as External_Solver
  note top of External_Solver
    BibliothÃ¨que externe pour l'optimisation
  end note
}

' ================================================
' === RELATIONS ENTRE LES COUCHES              ===
' ================================================

PresentationLayer -down-> ApplicationLayer : Appels des actions utilisateur

ApplicationLayer -down-> DomainServicesLayer : Orchestre les opÃ©rations mÃ©tier
ApplicationLayer -down-> AppUtilitiesLayer : PrÃ©pare les donnÃ©es
ApplicationLayer -down-> InfrastructureLayer : GÃ¨re la persistance et l'export

DomainServicesLayer -down-> AppUtilitiesLayer : Utilise des helpers de traitement (ex: DependanceBuilder)

AppUtilitiesLayer -down-> DomainServicesLayer : AccÃ¨de aux donnÃ©es du domaine (via services)
AppUtilitiesLayer -down-> InfrastructureLayer : Pour les opÃ©rations techniques (ex: gÃ©nÃ©ration ID)
AppUtilitiesLayer --> External_Solver : Envoie les donnÃ©es au solveur

InfrastructureLayer -down-> DomainServicesLayer : Popule les services du domaine (ex: ImportService)

' Relations des couches infÃ©rieures entre elles ou vers des dÃ©pendances
DomainServicesLayer --> External_Solver : (Moins frÃ©quent, mais possible si un service du domaine interagit directement)

' Relations vers les bibliothÃ¨ques externes (implicites dans Infra_DataAccess)
' On pourrait ajouter:
' Infra_DataAccess --> CsvHelper
' Infra_DataAccess --> QuikGraph
' Infra_DataAccess --> Microsoft.Msagl
' Infra_DataAccess --> System.Text.Json

@enduml